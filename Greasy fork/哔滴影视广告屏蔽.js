// ==UserScript==
// @name         哔滴影视广告屏蔽
// @namespace    http://tampermonkey.net/
// @version      0.1.1
// @description  哔滴影视广告屏蔽（图片广告屏蔽及视频广告跳过）
// @author       limbopro
// @match        https://www.btbdys.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=btbdys.com
// @grant        none
// @run-at document-end
// @license GNU GPLv3
// ==/UserScript==

ction(e){return l.matches(e)}}))}}}(),L=function(){var e=function(e,t){this.selectors=e,this.pseudoElement=t};e.prototype.matches=function(e){return!!this.selectors.find((function(t){var r=document.querySelectorAll(t);return Array.from(r).find((function(t){return t===e}))}))};return{extendSizzle:function(t){t.selectors.pseudos.is=t.selectors.createPseudo((function(t){if(""===t)throw new Error("Invalid argument of :is pseudo-class: ".concat(t));var r=t.split(",").map((function(e){return e.trim()})).reduce((function(e,t){return A.isSimpleSelectorValid(t)?e.push(t):m.logInfo("Invalid selector passed to :is() pseudo-class: '".concat(t,"'")),e}),[]),n=new e(r);return function(e){return n.matches(e)}}))}}}(),M=function(){var e,t=[":has",":contains",":has-text",":matches-css",":-abp-has",":-abp-has-text",":if",":if-not",":xpath",":nth-ancestor",":upward",":remove",":matches-attr",":matches-property",":-abp-contains",":is"],r=!1;function n(){if(!r){r=!0,e=C(),O.extendSizzle(e),D.extendSizzle(e),P.extendSizzle(e),L.extendSizzle(e);var t=e.selectors.createPseudo((function(e){if(/^\s*\/.*\/[gmisuy]*\s*$/.test(e)){var t,r=(e=e.trim()).lastIndexOf("/"),n=e.substring(r+1);e=e.substr(0,r+1).slice(1,-1).replace(/\\([\\"])/g,"$1");try{t=new RegExp(e,n)}catch(t){throw new Error("Invalid argument of :contains pseudo class: ".concat(e))}return function(e){return t.test(e.textContent)}}return e=e.replace(/\\([\\()[\]"])/g,"$1"),function(t){return t.textContent.indexOf(e)>-1}}));e.selectors.pseudos.contains=t,e.selectors.pseudos["has-text"]=t,e.selectors.pseudos["-abp-contains"]=t,e.selectors.pseudos.if=e.selectors.pseudos.has,e.selectors.pseudos["-abp-has"]=e.selectors.pseudos.has,e.selectors.pseudos["if-not"]=e.selectors.createPseudo((function(t){return"string"==typeof t&&e.compile(t),function(r){return 0===e(t,r).length}})),e.selectors.pseudos.xpath=e.selectors.createPseudo((function(e){try{document.createExpression(e,null)}catch(t){throw new Error("Invalid argument of :xpath pseudo class: ".concat(e))}return function(){return!0}})),e.selectors.pseudos["nth-ancestor"]=e.selectors.createPseudo((function(e){var t=Number(e);if(Number.isNaN(t)||t<1||t>=256)throw new Error("Invalid argument of :nth-ancestor pseudo class: ".concat(e));return function(){return!0}})),e.selectors.pseudos.upward=e.selectors.createPseudo((function(e){if(""===e)throw new Error("Invalid argument of :upward pseudo class: ".concat(e));if(Number.isInteger(+e)&&(+e<1||+e>=256))throw new Error("Invalid argument of :upward pseudo class: ".concat(e));return function(){return!0}})),e.selectors.pseudos.remove=e.selectors.createPseudo((function(e){if(""!==e)throw new Error("Invalid argument of :remove pseudo class: ".concat(e));return function(){return!0}}))}}function o(e){var r=e.type;if("ID"===r||"CLASS"===r||"ATTR"===r||"TAG"===r||"CHILD"===r)return!0;if("PSEUDO"===r){for(var n=t.length;n--;)if(e.value.indexOf(t[n])>=0)return!1;return!0}return!1}function i(e){var t=e.type;return" "===t||">"===t||"+"===t||"~"===t}function s(t,r,o){n(),void 0===r?(this.selectorText=A.normalize(t),this.tokens=e.tokenize(this.selectorText,!1,{returnUnsorted:!0})):(this.selectorText=t,this.tokens=r),!0===o&&(this.debug=!0)}s.prototype={createSelector:function(){var e=this.debug,t=this.tokens,r=this.selectorText;if(1!==t.length)return new l(r,e);var n=this.getXpathPart();if(void 0!==n)return new h(r,n,e);var o=this.getUpwardPart();if(void 0!==o){var i,s=parseInt(o,10);if(Number.isNaN(s))i=new d(r,o,e);else i=new h(r,this.convertNthAncestorToken(s),e);return i}var a=this.getRemovePart();if(void 0!==a)return new p(r,""===a,e);var u=(t=t[0]).length,f=this.getSplitPoint();if(void 0===f){try{document.querySelector(r)}catch(t){return new l(r,e)}return new c(r,e)}for(var v="",m=null,y="",b=0;b<f;b++)v+=t[b].value;for(b>0&&(m=t[b++].type);b<u;b++)y+=t[b].value;return-1===f?new l(r,e):new g(r,v,m,y,e)},getSplitPoint:function(){for(var e=this.tokens[0],t=-1,r=!1,n=0,s=e.length;n<s;n++){var a=e[n];if(i(a)){if(r)return;t=n}else o(a)||(r=!0)}if(r)return t},getXpathPart:function(){for(var e=this.tokens[0],t=0,r=e.length;t<r;t++){var n=e[t];if("PSEUDO"===n.type){var o=n.matches;if(o&&o.length>1){if("xpath"===o[0]){if(this.isLastToken(e,t))throw new Error("Invalid pseudo: ':xpath' should be at the end of the selector");return o[1]}if("nth-ancestor"===o[0]){if(this.isLastToken(e,t))throw new Error("Invalid pseudo: ':nth-ancestor' should be at the end of the selector");var i=o[1];if(i>0&&i<256)return this.convertNthAncestorToken(i)}}}}},convertNthAncestorToken:function(e){for(var t="..";e>1;)t+="/..",e--;return t},isLastToken:function(e,t){var r=e[t+1]&&"PSEUDO"===e[t+1].type&&e[t+1].matches&&"remove"===e[t+1].matches[0];return t+1!==e.length&&!r},getUpwardPart:function(){for(var e=this.tokens[0],t=0,r=e.length;t<r;t++){var n=e[t];if("PSEUDO"===n.type){var o=n.matches;if(o&&o.length>1&&"upward"===o[0]){if(this.isLastToken(e,t))throw new Error("Invalid pseudo: ':upward' should be at the end of the selector");return o[1]}}}},getRemovePart:function(){for(var e=this.tokens[0],t=0,r=e.length;t<r;t++){var n=e[t];if("PSEUDO"===n.type){var o=n.matches;if(o&&o.length>1&&"remove"===o[0]){if(t+1!==r)throw new Error("Invalid pseudo: ':remove' should be at the end of the selector");return o[1]}}}}};var a=!1;function u(){return a||this.debug}function c(e,t){this.selectorText=e,this.debug=t}function l(t,r){this.selectorText=t,this.debug=r,e.compile(t)}function f(t,r,n){this.selectorText=t,this.pseudoClassArg=r,this.debug=n,e.compile(this.selectorText)}function h(e,t,r){var n=e;m.startsWith(e,":xpath(//")&&(n=e.replace(":xpath(//","body:xpath(//")),f.call(this,n,t,r)}function d(e,t,r){f.call(this,e,t,r)}function p(e,t,r){var n=e.indexOf(":remove()"),o=e.slice(0,n);f.call(this,o,t,r),this.isRemoveSelector=!0}function g(t,r,n,o,i){l.call(this,t,i),this.simple=r,this.relation=n,this.complex=o,e.compile(o)}return c.prototype={querySelectorAll:function(){return document.querySelectorAll(this.selectorText)},matches:function(e){return e[m.matchesPropertyName](this.selectorText)},isDebugging:u},l.prototype={querySelectorAll:function(){return e(this.selectorText)},matches:function(t){return e.matchesSelector(t,this.selectorText)},isDebugging:u},f.prototype={querySelectorAll:function(){var t,r=this,n=[];if(this.selectorText){if(!(t=e(this.selectorText))||!t.length)return n}else t=[document];return t.forEach((function(e){r.searchResultNodes(e,r.pseudoClassArg,n)})),e.uniqueSort(n)},matches:function(e){return this.querySelectorAll().indexOf(e)>-1},isDebugging:u,searchResultNodes:function(e,t,r){t&&r.push(e)}},h.prototype=Object.create(f.prototype),h.prototype.constructor=h,h.prototype.searchResultNodes=function(e,t,r){for(var n,o=document.evaluate(t,e,null,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null);n=o.iterateNext();)r.push(n)},d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.searchResultNodes=function(e,t,r){if(""!==t){var n=e.parentElement;if(null===n)return;if(null===(e=n.closest(t)))return}r.push(e)},p.prototype=Object.create(f.prototype),p.prototype.constructor=p,g.prototype=Object.create(l.prototype),g.prototype.constructor=g,g.prototype.querySelectorAll=function(){var t,r,n=this,o=[],i=this.simple;if(i){if(!(t=document.querySelectorAll(i))||!t.length)return o;r=this.relation}else t=[document],r=" ";switch(r){case" ":t.forEach((function(e){n.relativeSearch(e,o)}));break;case">":t.forEach((function(e){Object.values(e.children).forEach((function(e){n.matches(e)&&o.push(e)}))}));break;case"+":t.forEach((function(e){var t=e.parentNode;Object.values(t.children).forEach((function(t){n.matches(t)&&t.previousElementSibling===e&&o.push(t)}))}));break;case"~":t.forEach((function(e){var t=e.parentNode;Object.values(t.children).forEach((function(t){n.matches(t)&&4===e.compareDocumentPosition(t)&&o.push(t)}))}))}return e.uniqueSort(o)},g.prototype.relativeSearch=function(t,r){e(this.complex,t,r)},{createSelector:function(e,t,r){return new s(e,t,r).createSelector()},enableGlobalDebugging:function(){a=!0}}}(),q=function(){var e,t=/[;}]/g,r=/[;:}]/g,n=/\S/g;function o(e){this.cssText=e}return o.prototype={error:function(e){throw new Error("CssParser: parse error at position ".concat(this.posOffset+e))},validateSelectors:function(t){for(var r=t.length;r--;)for(var n=t[r].groups,o=n.length;o--;){var i=n[o],s=i[i.length-1];if(e.selectors.relative[s.type])return!1}return!0},parseCss:function(){this.posOffset=0,this.cssText||this.error(0);for(var t=[];this.cssText;){var r=e.tokenize(this.cssText,!1,{tolerant:!0,returnUnsorted:!0}),n=r.selectors;this.nextIndex=r.nextIndex,123===this.cssText.charCodeAt(this.nextIndex)&&this.validateSelectors(n)||this.error(this.nextIndex),this.nextIndex++;var o=this.parseNextStyle(),i=!1,s=o.debug;void 0!==s&&("global"===s&&M.enableGlobalDebugging(),i=!0,delete o.debug);for(var a=0,u=n.length;a<u;a++){var c=n[a];try{var l=M.createSelector(c.selectorText,c.groups,i);l.pseudoClassArg&&l.isRemoveSelector&&(o.remove="true"),t.push({selector:l,style:o})}catch(e){m.logError("ExtendedCssParser: ignoring invalid selector ".concat(c.selectorText))}}}return t},parseNextStyle:function(){var e=Object.create(null),t=this.parseUntilClosingBracket(e);n.lastIndex=t+1;var r=n.exec(this.cssText);if(null===r)return this.cssText="",e;var o=r.index;return this.cssText=this.cssText.slice(o),this.posOffset+=o,e},parseUntilClosingBracket:function(e){r.lastIndex=this.nextIndex;var n=r.exec(this.cssText);null===n&&this.error(this.nextIndex);var o=n.index,i=n[0];if("}"===i)return o;if(":"===i){var s=o;t.lastIndex=s,null===(n=t.exec(this.cssText))&&this.error(s),o=n.index,i=n[0];var a=this.cssText.slice(this.nextIndex,s).trim(),u=this.cssText.slice(s+1,o).trim();if(e[a]=u,"}"===i)return o}return this.nextIndex=o+1,this.parseUntilClosingBracket(e)}},{parseCss:function(t){return e=C(),new o(A.normalize(t)).parseCss()}}}();function B(t){if(!t)throw new Error("Configuration is not provided.");var r=t.styleSheet,n=t.beforeStyleApplied;if(n&&"function"!=typeof n)throw new Error("Wrong configuration. Type of 'beforeStyleApplied' field should be a function, received: ".concat(e(n)));var o,i,s=function(){var e,t,r=["mouseover","mouseleave","mouseenter","mouseout"],n=["keydown","keypress","keyup","auxclick","click","contextmenu","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseout","mouseup","pointerlockchange","pointerlockerror","select","wheel"],o=["wheel"],i=m.isSafariBrowser?n.filter((function(e){return!(o.indexOf(e)>-1)})):n,s=function(r){e=r.type,t=Date.now()};i.forEach((function(e){document.documentElement.addEventListener(e,s,!0)}));return{isIgnoredEventType:function(){return r.indexOf(e)>-1&&Date.now()-t<10}}}(),a=[],u=[],c={},l=window.addEventListener;var f={attributes:!0,attributeOldValue:!0,attributeFilter:["style"]};function h(e,t){if(!m.MutationObserver)return null;var r=t.map((function(e){return e.style})),n=new m.MutationObserver(function(e){return function(t,r){if(t.length){var n=t[0].target;r.disconnect(),e.forEach((function(e){g(n,e)})),++r.styleProtectionCount<50?r.observe(n,f):m.logError("ExtendedCss: infinite loop protection for style")}}}(r));return n.observe(e,f),n.styleProtectionCount=0,n}function d(e){var t=e.node;e.removed=!0;var r=m.getNodeSelector(t),n=c[r]||0;n>50?m.logError("ExtendedCss: infinite loop protection for SELECTOR",r):t.parentNode&&(t.parentNode.removeChild(t),c[r]=n+1)}function p(e){if(!e.protectionObserver&&(!n||(e=n(e))))for(var t=e.node,r=0;r<e.rules.length;r++){var o=e.rules[r].style;if("true"===o.remove)return void d(e);g(t,o)}}function g(e,t){Object.keys(t).forEach((function(r){if(void 0!==e.style.getPropertyValue(r)){var n=t[r];n=(o=n.trim(),i="!important",s=o.indexOf(i,o.length-i.length),s>=0?o.substring(0,s):o).trim(),e.style.setProperty(r,n,"important")}var o,i,s}))}function v(e){e.protectionObserver&&e.protectionObserver.disconnect(),e.node.style.cssText=e.originalStyle}function y(e){var t,r=e.selector.isDebugging();r&&(t=m.AsyncWrapper.now());var n=e.selector.querySelectorAll();if(n.forEach((function(t){var r=function(e){for(var t=0;t<u.length;t+=1)if(u[t].node===e)return u[t];return null}(t);if(r)r.rules.push(e),p(r);else{var n=t.style.cssText;p(r={node:t,rules:[e],originalStyle:n,protectionObserver:null}),u.push(r)}})),r){var o=m.AsyncWrapper.now()-t;"timingStats"in e||(e.timingStats=new m.Stats),e.timingStats.push(o)}return n}function b(){var e=[];E(),a.forEach((function(t){var r=y(t);Array.prototype.push.apply(e,r)}));var t=u.length;if(e.length>0)for(;t--;){var r=u[t];-1===e.indexOf(r.node)?(v(r),u.splice(t,1)):r.removed||r.protectionObserver||(r.protectionObserver=h(r.node,r.rules))}!function(){if(o)return;o=!0,e=x,m.MutationObserver?(i=new m.MutationObserver((function(t){t&&0!==t.length&&(s.isIgnoredEventType()&&function(e){for(var t=0;t<e.length;t+=1)if("attributes"!==e.type)return!1;return!0}(t)||e())}))).observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["id","class"]}):l&&(document.addEventListener("DOMNodeInserted",e,!1),document.addEventListener("DOMNodeRemoved",e,!1),document.addEventListener("DOMAttrModified",e,!1));var e}(),function(){if(S)return;S=!0;var e=a.filter((function(e){return e.selector.isDebugging()})).map((function(e){return{selectorText:e.selector.selectorText,timingStats:e.timingStats}}));if(0===e.length)return;m.logInfo("[ExtendedCss] Timings for %o:\n%o (in milliseconds)",window.location.href,e)}()}var w=new m.AsyncWrapper(b,150),x=w.run.bind(w);function E(){var e;o&&(o=!1,e=x,i?i.disconnect():l&&(document.removeEventListener("DOMNodeInserted",e,!1),document.removeEventListener("DOMNodeRemoved",e,!1),document.removeEventListener("DOMAttrModified",e,!1)))}var S=!1;a=q.parseCss(r),this.dispose=function(){E(),u.forEach((function(e){v(e)}))},this.apply=function(){b(),"complete"!==document.readyState&&document.addEventListener("DOMContentLoaded",b)},this._getAffectedElements=function(){return u}}return B.query=function(e,t){if("string"!=typeof e)throw new Error("Selector text is empty");var r=m.AsyncWrapper.now,n=r();try{return M.createSelector(e).querySelectorAll()}finally{var o=r();t||m.logInfo("[ExtendedCss] Elapsed: ".concat(Math.round(1e3*(o-n))," μs."))}},B}();
;
function H(){var a=x.g;if(a)try{eval(u.createScript(a))}catch(b){d(b)}};function I(){10>document.documentMode||document.addEventListener("click",function(a){try{if(2!==a.button){var b=a.target;if(b instanceof Node){for(a=b;a&&!(a instanceof HTMLAnchorElement);)a=a.parentNode;var c=a}else c=void 0;if(c){a:{try{if(w.isSubscriptionIntercept){if("http:"===c.protocol||"https:"===c.protocol){if("subscribe.adblockplus.org"!==c.host||"/"!==c.pathname){var e=void 0;break a}}else if(!c.href||-1===c.href.indexOf("abp:subscribe")){e=void 0;break a}e=c.search?"adguard:subscribe"+
c.search:c.href.replace("abp:subscribe","adguard:subscribe");break a}}catch(f){d(f)}e=void 0}if(e)c.href=e;else{a:{try{if(w.isUserscriptIntercept&&("http:"===c.protocol||"https:"===c.protocol)&&-1!==c.pathname.indexOf(".user.js")&&c.pathname.endsWith(".user.js")){var k=c.href;c.search&&(k=k.replace(c.search,""));var g="adguard:userscript?location="+k;break a}}catch(f){d(f)}g=void 0}g&&(c.href=g)}}}}catch(f){d(f)}})};var J=!0,K=!0,L=!0,M=-1!==["mail.yahoo.com","map.baidu.com"].indexOf(document.location.hostname),N=-1!==["muve.pl"].indexOf(document.location.hostname);window!==window.top&&(J=1E5<Math.max(document.documentElement.clientHeight,window.innerHeight||0)*Math.max(document.documentElement.clientWidth,window.innerWidth||0),x.a&&x.a.hasOwnProperty("isReferrerRuleElemhide")&&x.a.hasOwnProperty("isReferrerRuleJsInject")&&(K=x.a.isReferrerRuleElemhide,L=x.a.isReferrerRuleJsInject));var O=v||"adgRunId";
if(!document[O]){document[O]=!0;if(K){M||(J&&x.b&&D(x.b),D(x.h));var P=x.c;P&&!r&&(new ExtendedCss({styleSheet:P,i:C})).apply()}L&&H();(w.isSubscriptionIntercept||w.isUserscriptIntercept)&&I();N||y()}delete x.b;delete x.h;delete x.c;delete x.g;delete x.a;delete x.f;n.removeChild(h);})();


/* 禁止新页面跳转 */

var _blank = document.querySelectorAll("a");
var i;
for (i = 0; i < _blank.length; i++) {
_blank[i].target = "_self";
}

/* 延迟1秒中清除广告元素以避免bde4反屏蔽检测 */

setTimeout(()=>{
var newstyle=".ayx[style^=\"position: fixed;bottom\"],#ad-index,#adsbox, .ayx[style=\"display:block;\"], .ayx[style^=\"position: fixed;bottom\"], a[target*=_new] {display:none !important;}";
var creatcss=document.createElement("style");
creatcss.innerHTML=newstyle;
document.getElementsByTagName('head')[0].appendChild(creatcss)
},500);